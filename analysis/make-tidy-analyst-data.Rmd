

```{r setup}
library(here)
library(dplyr)
library(readxl)
library(stringr)

# load data
raw_analyst_data <- read_xlsx(here("data", "Salaries_of_State_Agencies_-_Multi-Year_Report_20250210.xlsx"))

# Function to remove numbers from text and get unique values
clean_list_of_names <- function(text) {
  # Split text into separate roles if comma-separated
  roles <- unlist(strsplit(text, ","))
  # Remove numbers and trim whitespace
  cleaned_roles <- 
    gsub("[0-9]", "", roles) %>% 
    trimws(.) %>% 
    stringr::str_to_title(.)
  
  # Count frequencies and sort
  role_freq <- table(cleaned_roles)
  sorted_roles <- names(sort(role_freq, decreasing = TRUE))
  
  # Combine back into comma-separated string
  paste(sorted_roles, collapse = "\n")
}
```


```{r}
analyst_salary_data <- 
  raw_analyst_data %>% 
  rename(
    Year = `FISCAL YEAR`,
    Agency = AGENCY,
    Role = CLASSIFICATION,
    Salary= `SALARY (ANNUAL)`,
    Agency_no = `AGENCY #`
  ) %>% 
  group_by(Agency) %>% 
  mutate(total_analysts = n()) %>% 
  mutate(
    Agency = if_else(total_analysts < 11, "Multiple Agencies", Agency),
    cleaned_roles = clean_list_of_names(Role)
  ) %>% 
  reframe(
    average_analyst_salary = round(median(Salary), -3),
    total_analysts = median(total_analysts),
    types_of_analysts = first(cleaned_roles)
  ) %>% 
  arrange(-total_analysts) %>% 
  relocate(types_of_analysts)

analyst_salary_data
```


```{r}
write.csv(analyst_salary_data, here("save", "analyst_salary_data.csv"))
dput(analyst_salary_data %>% as.data.frame())
```


I used this data with Shiny assistant to make an interactive bar chart. 

https://shinylive.io/r/editor/#code=NobwRAdghgtgpmAXGKAHVA6ASmANGAYwHsIAXOMpMAGwEsAjAJykYE8AKAZwAtaJWAlAB0IdJiw6pqRUtUEixzNuwAmU1o2GiGSjvU5itIgMQACAMKM4UcqZU2onOKRFErAcxIB9e6SimAHgBaOwcMADNmeHYRU1MAQXcKAlZTAF5TAhiwAHksAFEAcRyAOVMACXz4gBkAFXKEgFV6vIBJWoBNITxTbvLGgFl4soBlfKwANVbzfJHcUwARfIAFeKxagfyS2tMcgDFu+e7arGGR5bza+NrW0vml5Z39w96IOPeP9+74hYHWktaIxO11aE3yphGk3Mc0WKyeBx63XyA2W1RyHU221hjxeSIWjXMILu2PhuLenwp3XMeQK5hupRhD1JiLA1JKI0G4wSJQWpgAQo0RhCoYy4biwAUwSVGvl7is1hstsyjuSKR8+jlBf9CqYAGQWHIDAbCibQuWPXYIo5gABSjQW01aNWxCsxtXFdqB01lLvWbstZLVnyRJSmWFKbudAEVGjV2h1ze6WVUsNUOqZqimASUdcNeYSComAyy8vytSVZkKlhMSYGg18wOVWkF8vmcnkHSUQTmDUbxctGnzqtNTMjlkKCjcCv6Rh0gcjxR1NfUmi0sPH5nkiqU6-XemA9lugVgEyTi9bkeNCltzOmhl3Cm6i88WQOhyPmq1h51e38RiNbhKXd626C5hxmTcCmKUYrlqfJxS2K9TweV0lXPfdViwABpIV9VpAoiRKZ8rVePc4m6IFrnBPZWgKUwhiwEZyhqapNz2GiZktUx6nglkxnMSc1nTfYIVg3iVTI-dM0KQFqhBMFTDA6Z0zw2YU3MBpqSNdo4PEqTWhjUs2ROHJql-QEAJ3RFVRAsA33A2E9i2MYIXGKYZhGcU-m-ITiPFGimL1UwAHUvwWYcnL86zJO6ME4NOdkEnY+JaNFC0X2teJCnXcxGjqRpCzPDL9wE1o-i7MzPRuTitL-SygOisjumk2T5OowFCTM-YOPGcUWpGOSbgU6lGnZfIzNqnT8j07pgqorBTAKEZNSwDyookpqwDkvlS31f58WPVpZnmAUCMadDmtKHV4uNAtwUNAUFhGe9gKDUDBwckZ4icn9KJ5NYnqCk4cy8gBXahSFoKQ4ASJIIAIWg4E4boBFwWJTFIGQoGoLwoGgOROFITh0kydgAEYAGYyYAdnmMmACZ6YAVnmAAWCmAA55mZ+nuYpgA2OmAE5Wbp6mybp-mKcl3nTDJ1mubl+mhbpsmJblgAGFnSMktUhcVjnadMDntZN+ZqaN6nZf57X+et9WmZV0wmdF53ZdZ9WBfmCnpdMCmNe5xX0d1z56aNsO+e59WyadsnBbl13Kbp32GfN1H0agAA3OBmCSXH8dYQmvE4bGJBJrJ9Y1qv5iF-mq4DzWyfrumNY55vjbb6vTErrum9Z9um-rhvg5DvdB-boX-d7oeG6F+mJ6Fie697tWB5njbR73IXx5r6ml4nnfNaZ9uOcXrva4noea7P4ebM3tUm+P3vGYnqeG77g+T872en9n7+N-vmqDm-85ZSwnr-eYht97n37ufK+msh5aCMBAMwexaAQxzqYIgoNSD0XBpDaGsNkiI2JnjFQphOBuFwfQVImM-A4zxtjQuRNXAeG8L4fwwQsFsIgD4BwpgACkAA+AR6NwjoPIIwdgiRkipAAIQZG6AMfBUNqAwxkfDEhKNBEiIzowZgEAkiqCRlkOh2N85MMJpwAQyDQa0ECCEVAUA87hGoHYlQMRySkG4HAeAJN9BeG8b4uA7Bs6ME4LQEgJMmbp3JAQFgHiR7hHBjjTgBArAUBJicGUaMbLxMYCoLwPioAqBzp4ik3AKbZAmIjAA7nwdwGMfGKSIKgcGNhIlvCIOEBIBcrGmD4E0mGIw-C2G6bsHhKNckUlQOwAg1BHDE0UWAcgAAPUgQQYA4LgCocUtQsbUEyNgsgAz4ZuNKaQ-gpg9h5WqEEG4mxTAACsiD0EyAszgETxHxMhiQYm9TvG9CEN0RhBMXDArAKcoZphoB+PCG4aF896as1MOItJ2NTCsGsIwFGI9YkfCkDIOQOQcFtNINkegLBzDcBYC4HoPjaDuG4Lg5ZndUCrKmSPfJhT4UyDKSPOIsz5mLJJt0NZGytnkF2Y1SkYASh8sQEQzRSNTAAu4JrbhqK4C1MwaC5hpCrCmDgKs+ZoNSnkMiEQGATTaDE0zra0G2NaAAC8OkkAwIcAV7wmDsHxWqboCx+EjGwYwAgcBFWervu8KA7BuBWB6cs5lpBUCcEQAAejTRwjAbg4CeAgBgTwmc01YDgNnCAoM4AtlWagCgTg00jFLowEhQRulBBGTYStGiEZIyCMoiGtAggdGxUEEtqAqFptZgQGA7gghM1YKgVmaaoD0GwaQPhfhI17m6DkHhGBChEEzrsGtbxA1+BaYweh8wG0LKbSq8Z7bbBdpIaYEIfbIaDuxYtOAY6L2bvrH4RgSQWX7i8PQBZEAADWuKo1aA+LB0wSCRAiCcIwMJDjUWg3hr8iA7A+BkvmKuslAhTAgHRoRnBAASSljBqW0vQ1YCApTGDLGkLIDgpGbKoHQ4StdchymfA4STHNeb11QGmZ8VZJMAB+ZiGF9KJuJj4qQMhSa7awRT7xSDzphss6jf6PhuERmQN1bwMgAHJuBmY03EMwtRjW4O8TYUwaAa0sGJlEoJphqPIyjeK6T8LGAwBsOwWTFiwWcHmPQRlGAguMAg2kT1YA-UfFs-ZppTmXPYuJoM7gB7MGYyIP21AXrcthL8yppxhMQnHAOb0yxRNEAvAC0F8loW9VWMi9F2L8XEvJcAQ2AITAhHxDCc44ZjbWCKoo01twLX2BZxzmNsLzDi4Tc6+4GLLAet4BeGkozkNvlpD2DUMYNjrOmFKznPg8LRUrPs-pzT9mx0ROw7dqAOCiDdDxTo0RUaFmsFXfxikqyoCrNtSTOghMgdqkhrIHT+4zDjPiPJ5GO2o0fEhgQCDzWnPLNwNKmz1zZtObVU07BJdGPEycE45gmMcXo4Q+duIrBQfg4yJD8lXqMe0Dh7dh7FJ3uY1i+4QZGRsk+lMGYfIEBOCg0NWN+GqRYUqpYDDZJ1A5CmHtREsDcAufvB+bmtwAOCmYOWSwZgrAXiS9MI0Jwzn9FQFSG4Jj+u4iG88GwC3TuSZWEzuwYT7CHAUbU8Rm3Jawn288y7zB4yFfdp80GPrHxhei9MBz9ghyMjz3mIwEmOeMb54bm87PGtk-vEu4wBZ9A4BZ-T7a8l9B3DEGkHn5ZtTeDkGgxSeD5FOPowAL5aAH0hmXvB+DxHQOwOxJM7HzBQ2hjIC+c5aDAAPgAukAA


Here's the view version

https://shinylive.io/r/app/#h=0&code=NobwRAdghgtgpmAXGKAHVA6ASmANGAYwHsIAXOMpMAGwEsAjAJykYE8AKAZwAtaJWAlAB0IdJiw6pqRUtUEixzNuwAmU1o2GiGSjvU5itIgMQACAMKM4UcqZU2onOKRFErAcxIB9e6SimAHgBaOwcMADNmeHYRU1MAQXcKAlZTAF5TAhiwAHksAFEAcRyAOVMACXz4gBkAFXKEgFV6vIBJWoBNITxTbvLGgFl4soBlfKwANVbzfJHcUwARfIAFeKxagfyS2tMcgDFu+e7arGGR5bza+NrW0vml5Z39w96IOPeP9+74hYHWktaIxO11aE3yphGk3Mc0WKyeBx63XyA2W1RyHU221hjxeSIWjXMILu2PhuLenwp3XMeQK5hupRhD1JiLA1JKI0G4wSJQWpgAQo0RhCoYy4biwAUwSVGvl7is1hstsyjuSKR8+jlBf9CqYAGQWHIDAbCibQuWPXYIo5gABSjQW01aNWxCsxtXFdqB01lLvWbstZLVnyRJSmWFKbudAEVGjV2h1ze6WVUsNUOqZqimASUdcNeYSComAyy8vytSVZkKlhMSYGg18wOVWkF8vmcnkHSUQTmDUbxctGnzqtNTMjlkKCjcCv6Rh0gcjxR1NfUmi0sPH5nkiqU6-XemA9lugVgEyTi9bkeNCltzOmhl3Cm6i88WQOhyPmq1h51e38RiNbhKXd626C5hxmTcCmKUYrlqfJxS2K9TweV0lXPfdViwABpIV9VpAoiRKZ8rVePc4m6IFrnBPZWgKUwhiwEZyhqapNz2GiZktUx6nglkxnMSc1nTfYIVg3iVTI-dM0KQFqhBMFTDA6Z0zw2YU3MBpqSNdo4PEqTWhjUs2ROHJql-QEAJ3RFVRAsA33A2E9i2MYIXGKYZhGcU-m-ITiPFGimL1UwAHUvwWYcnL86zJO6ME4NOdkEnY+JaNFC0X2teJCnXcxGjqRpCzPDL9wE1o-i7MzPRuTitL-SygOisjumk2T5OowFCTM-YOPGcUWpGOSbgU6lGnZfIzNqnT8j07pgqorBTAKEZNSwDyookpqwDkvlS31f58WPVpZnmAUCMadDmtKHV4uNAtwUNAUFhGe9gKDUDBwckZ4icn9KJ5NYnqCk4cy8gBXahSFoKQ4ASJIIAIWg4E4boBFwWJTFIGQoGoLwoGgOROFITh0kydgAEYAGYyYAdnmMmACZ6YAVnmAAWCmAA55mZ+nuYpgA2OmAE5Wbp6mybp-mKcl3nTDJ1mubl+mhbpsmJblgAGFnSMktUhcVjnadMDntZN+ZqaN6nZf57X+et9WmZV0wmdF53ZdZ9WBfmCnpdMCmNe5xX0d1z56aNsO+e59WyadsnBbl13Kbp32GfN1H0agAA3OBmCSXH8dYQmvE4bGJBJrJ9Y1qv5iF-mq4DzWyfrumNY55vjbb6vTErrum9Z9um-rhvg5DvdB-boX-d7oeG6F+mJ6Fie697tWB5njbR73IXx5r6ml4nnfNaZ9uOcXrva4noea7P4ebM3tUm+P3vGYnqeG77g+T872en9n7+N-vmqDm-85ZSwnr-eYht97n37ufK+msh5aCMBAMwexQbw0hiQDGRBTBWHCG4GANhTBQDhikUw0B4DIwgHgghNhcakNSMEUw4R0EEEwRAdgAAPAQpgQDo04YEEImNpAAHcc5cK0HEWg4RTDsHcFYKQ2Q0Y9G4TwvhNlUAsCJoI0whNGCcCkLQUgXDrTKIEMAYAZMAC6ViR4CKYZowmcB2CkEYLQGAIjODsE0YwImwB6ZWNRhjNxHivE+L8dYgQkjTAAF90ZmHMKDQmRAYAYyMdQGGBBHAwxYRg2gWC+BOKgCoUwRAZFWDkHwdwpS3iYyINQTgiBECY1qOkuA5hsnoxEW4FQxMmF6IMXQYxnDrT7nMZYmxXSel9JCCXdAch2DdMYL0+YuS2H5I4UslQaiR7SNkQAQi2aYAApHwY5pNuhlPFHjFQ4pSDcDgCjHZd9TCOPIBrFxRBQboHEZwUG+hXGLJ6XTOmUT5h-IBYwIFyzubzHhtwFg0LtlRJHjE0wcAGkw3URSLZqL0YxOiW85xWzODzGINQagaAnAk26GMkQcSIAmFMHsWgEMc6lNBqQei4NIbQ1hskRGpLcFwHwYwQhXKKFI3mDc3RbguX0FSJjPwOM8bY0LkTVwHhvC+H8EwtwcBPAQB8A4E5AA+Y56NwisvIFCxIyRUj7IyN0AYPKoYZP5fDQVKMzUWvJDATlNhnF2vhqkDIcz1DsGDSkeYNCxV0JIfaqJPqM6MGYBAJIqgkZZCVdjfOarCacBRYyiAoNaA6M0XncI1BS0qBiOSe5cB4Ak30F4Bt0Rs76I2STJm6dyRZOWXWj4LCKXFwIFYCgJMTgyjRjZftKgvAPOKeIkecRuAU2yBMRGIiqkYweYpIgqBwY2C7WUhIBcC2mD4LumGIw-C2FPTkLVjKwC9opKgdgBBKWcGJk6sA5BOGkCCP68gtyWS1CxtQTIXyyCXvhtWlQSNiH8GZXlaoQQbibFMAAKyIPQTIX7ODSNoFk9hxNt33N6EIboqqCYuCo2AWD17yGwByW4Jj896as2YbQTgWTIOsGsIwFGI9X3vCkDIOQOROWHuMd0egLBzAIt8S8B5tB3DcC5b+zuqBOEoxnR8OdXh8EyGXS899n7HA-v3P+wDwG4CgYAeqMAJQTOIA9QjRD5HuCa1KYwZhcAxF+Zo+q4mLAYZwE4Z+0GCGSmRBSbunjphM48dBtjWgAAvY9JAMCHBXe8Jg7BROUjAAsE1IwvmMAIHANzuWXlxCgOwbgeCaVgA06QVAjSAD0nWdUYH1YajAnhM6dawHAbOJa4Atk4agCgThOsjFLm4pGQQylBFvYGoIUbBVBBdRDWgQQOiCaCKN1AcrOuswIDAdwQQmasFQKzTrUB6BfNIMavwtW9zdEfQa7LhQiCZ12DNt4pW-D7t8djeYC3KVLeJqe9btgtuIZCLtyGB3BOLTgKd5TeA8sfD8IwJImn9xeHoJSiAABrYTLzolxGiUgkQIgnCMA7TotZ7D2B8Bk-MF7MnnlxB55ygAJPJxgimtE6KsBABDjBljSFkBwbFYny1y68AsvLOqSb9e1Q4fTnwBEZAAH45pVeeomuuPihtMAbqNrBzfvFIHdmGv6Rcfc+G4RGZAstvAyAAcm4D7u3cQzC1Ai1y+5RC0AzZYLD2pe6RdUIpDZkmBvRXis+cqvNtGhX0DUxgQhjBydpFyy+wPphg+h93RHn50fGPcH++yupe3UB5brx2pPhuiXZHA8qs9+aiaIBeKnmw6fc3BYLfMHP7g88sEL8XorgCGwBCYKa+IHaE0QkW6wNzgvB+0OMVnHOCbM-quLpvifuf8+z5xz0XjHvIZWoIGkPYNQxhgpb-XtxEB8EtZs67vHofTtCN2EWsoBOUiA-97dQ98EYMMg6BCZB01RCN0sncE55gy9+RslmESAuUkDHk6tmFYBWVLdvg3FsZug8sadTAeFjlzU8tKVWAXsECKROEoBOFEtYCeNZN8C4hIZZAUDugShQYYB6B2VT14hTdkYcduCMZHcWtpB3AIDE9iNych8idDgHNcd3geAiARFIYCBydKURCGlJ0sBp1NCeDlC8Z3B3UMgG50CRhnA0l9CkNrCYZMZTANYsC-M683F0tsDsYMZQ9zCnDydM5sYrMsgm5uZtZj4W4G5mYG4n44iNZ58lD9D28LkwAm5xRmZxRj5xRB4cj8iWQn4CjcB64qcgxUj3hWBWD2DTA4CuC9xeCbD9xFDPhQDMZ893Ar0Mgp0fR0D8gIA-krBiEGFmNKFiFRjh05AkseMGAMlgiSMfs2Ael2Vf0WBmBWAXh0DGhqVNioBUg1ihNpDljPA2ADjLcrBM52AtcjUdVBcbceF0DRsO1qUG1fNpdSkZEE1PUkZNDqi4hujeiGjOD2BIMMh54Y0SYoSMYYSG48NISUjS9V0P9DCMUSZGj2B6B3ByU2Nf0RFeByA9NND0FpECEMisTgiYBCkMsUDU4g96I+B3EhCsCYNcDqSiAEMSYfdtCREfdGSRg68RFiEKVAiAMASUS2SicqTpDcCSZ5ZGS+RMDoCcC6SvDRTINf98DATiEwD5S+jTDwRBjoBScYYrADESBCNs5dEMsqkKCR4R5m9yQCV6UGdhjeB+B4h0B2BS0SZS1wUc4Wcw0gyc4tAwAYkrEgA
